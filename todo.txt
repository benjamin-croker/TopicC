Write the optimiser and training process